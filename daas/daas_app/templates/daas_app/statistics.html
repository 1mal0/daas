{% extends "daas_app/base.html" %}

{% block extra_head %}
    {% load staticfiles %}
    <link href="{% static "css/statistics.css" %}" rel="stylesheet">
{% endblock %}

{% block title %}Statistics{% endblock %}

{% block page_width %}85%{% endblock %}

{% block body %}
    <div align="center">
        <!-- ECharts import -->
        <script src="http://echarts.baidu.com/build/dist/echarts.js"></script>
        <!-- Prepare a Dom with size (width and height) for ECharts -->
        <div class="alert alert-info" style="width:85%">
            <h4><strong>Time since last chart update:</strong> {{ time_since_last_update }}</h4><br>
            {% url 'update_statistics' as button_url %}
            {% include "daas_app/button.html" with button_class="btn-success" show="True" enable=perms.daas_app.update_statistics_permission url=button_url icon_class="fa fa-refresh" text="Update charts" %}
        </div>
        {% for chart in charts %}
        <div class="col-sm-{% if chart.full_width %}12{% else %}6{% endif %}">
            <h1>{{ chart.title }}</h1>
            <div id="{{ chart.name }}" style="height:400px"></div>
            <br><br>
        </div>
            <script type="text/javascript">
                // configure for module loader
                require.config({
                    paths: {echarts: 'http://echarts.baidu.com/build/dist'}
                });

                // use
                require(
                    ['echarts',
                     'echarts/chart/line',
                     'echarts/chart/{{ chart.echart_required_chart }}'], // require the specific chart type

                    function (ec) {
                        // Initialize after dom ready
                        var myChart = ec.init(document.getElementById('{{ chart.name }}'){% if chart.echart_theme %},'{{ chart.echart_theme }}'{% endif %});

                        // Load data into the ECharts instance
                        myChart.setOption({{ chart.content|safe }});
                    }
                );
            </script>
        {% endfor %}
    </div>
{% endblock %}