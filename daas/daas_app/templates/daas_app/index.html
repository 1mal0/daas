{% extends "daas_app/base.html" %}
{% load pagination_tags %}

{% block extra_head %}
    {% load staticfiles %}
    <link href="{% static "css/pagination.css" %}" rel="stylesheet">
{% endblock %}


{% block title %}DaaS{% endblock %}

{% block body %}
{% autopaginate samples 5 as paginated %}
{% if samples %}
<ul>
    {% for sample in paginated %}
        <div class="panel panel-default">
            <div class="panel-heading" style="column-count: 2;">
                <img src="{% static "images/file_types/"|add:sample.file_type|add:".png" %}" width=30 height=30 /><b>  {{ sample }}</b>
                <div align="right">{{ sample.upload_date }}</div>
            </div>
            <div class="panel-body">
                <b>Hashes:</b>
                <ul>
                    <li>MD5: {{ sample.md5 }}</li>
                    <li>SHA1: {{ sample.sha1 }}</li>
                    <li>SHA2: {{ sample.sha2 }}</li>
                </ul>
                <br>
                {% if sample.finished %}
                    {% if sample.decompiled %}
                        <b>Elapsed time:</b> {{ sample.result.elapsed_time }} seconds.
                    {% elif sample.result.timed_out %}
                        <b>Timeout reached</b> after {{ sample.result.timeout }} seconds.
                    {% elif sample.redis_job.is_cancelled %}
                        <b>Cancelled</b>
                    {% else %}
                        <b>Error decompiling:</b> {{ sample.result.decompiler }} was not able to decompile this file. Is this a valid {{ sample.file_type }}?
                    {% endif %}
                {% else %}
                    <i>{{ sample.status }}... </i><i class="fa fa-spinner fa-spin" style="font-size:20px"></i>
                {% endif %}
                
                </br></br>
                {% if sample.content_saved %}
                    <button type="button" class="btn btn-primary" onclick="location.href='{% url 'download_sample' sample.id %}';" {% if not sample.downloadable %}disabled{% endif %}><i class="fa fa-download"></i>  Download Sample</button>
                {% endif %}

                {% if sample.redis_job.is_cancellable %}
                    <button type="button" class="btn btn-danger" onclick="location.href='{% url 'cancel_job' sample.redis_job.pk %}';"><i class="fa fa-close"></i>  Cancel Task</button>
                {% endif %}

                {% if sample.decompiled %}
                    <button type="button" class="btn btn-primary" onclick="location.href='{% url 'download_source_code' sample.id %}';"><i class="fa fa-file-code-o"></i>  Download Source Code</button>
                {% endif %}

                {% if sample.finished %}
                    <button data-toggle="collapse" class="btn btn-info" data-target="#details_of_{{ sample.id }}"><i class="fa fa-info-circle"></i> Details</button>
                {% endif %}

                <div style="float: right;">
                    {% if sample.finished and sample.content_saved %}
                        <button type="button" class="btn btn-warning" onclick="location.href='{% url 'reprocess' sample.id %}';"><i class="fa fa-refresh"></i> {% if sample.result.decompiled_with_latest_version %}Force Reprocessing{% else %}Process with latest changes{% endif %}</button>
                    {% endif %}

                    <button type="button" class="btn btn-danger" onclick="location.href='{% url 'delete_sample' sample.id %}';"><i class="fa fa-trash-o"></i>  Delete</button>
                </div>

                {% if sample.result %}
                    <div id="details_of_{{ sample.id }}" class="collapse">
                        <br>
                        <div class="well" style="background: rgb(250, 250, 250);">
                            <b>Timeout:</b>  {{ sample.result.timeout }} seconds<br>
                            <b>Elapsed time:</b>  {{ sample.result.elapsed_time }} seconds<br>
                            <b>Exit status:</b> {{ sample.result.exit_status }}{% if sample.result.exit_status == 0 %} (OK){% endif %}<br>
                            <b>Decompiled: </b> {{ sample.result.decompiled }}<br>
                            <b>Decompiler: </b> {{ sample.result.decompiler }}<br>
                            <b>Output: </b><br>{{ sample.result.output }}<br>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    {% endfor %}
</ul>
{% else %}
There are no samples to show.
{% endif %}
{% paginate %}
{% endblock %}